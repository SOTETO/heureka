#!/bin/bash

source "git-setup.cfg"

source "commands/init"
source "commands/git-clone-rm"
source "commands/docker"
source "commands/drops"
source "commands/arise"

function man () {
  echo "
HEUREKA CLI
Version: $(cat $(getDir)/VERSION)
Usage: [command]
Commands:
  git clone   			Clone the required git repositories
  git rm      			Remove the git repositories
  docker up   			Start the 'docker-compose up' considering the '.docker-conf/docker-compose/.env.dev' file
  docker rm   			Stop and remove all docker containers described in the docker-compose file
  docker rm drops volumes	Remove the drops volumes. That means the database contents.
  docker rm dispenser volumes   Remove the dispenser volumes. That means the database contents.
  drops up man			Shows a manual explaining how to setup the DROPS backend service
  drops admin			Sets admin access rights in DROPS for a specific user identified by its email address
  arise up man			Shows a manual explaining how to setup the ARISE frontend service
  exit				Close console
  *           			Help
"
}

function init () {
  printf "Welcome to HEUREKA!\nSetup a development environment to implement the microservice DROPS."
  initPathes
  printf "\n"

  for (( ; ; ))
  do
    read -r -p "heureka> " cmd sub para1 para2
    case "$cmd" in
	"git")
	  case "$sub" in
		"clone") gitClone
			;;
		"rm") gitRemove
			;;
	        *) man
			;;
	  esac
	  ;;
	"docker")
	  case "$sub" in
		"up") dockerRun
			;;
		"rm")
		  case "$para1" in
			"drops")
			  case "$para2" in
				"volumes") dockerRmVolumes drops-database
					;;
				*) man
					;;
			  esac
			  ;;
			"dispenser")
			  case "$para2" in
				"volumes") dockerRmVolumes dispenser-database
					;;
				*) man
					;;
			  esac
			  ;;
			"") dockerRm
			  ;;
			*) man
			  ;;
		  esac
			;;
		*) man
			;;
	  esac
	  ;;
	"drops")
	  case "$sub" in
		"up")
		  case "$para1" in
			"man") dropsMan
			  ;;
			*) man
			  ;;
		  esac
			;;
		"admin") dropsAdmin
	  		;;
	  esac
	  ;;
	"arise")
	  case "$sub" in
		"up")
		  case "$para1" in
			"man") ariseMan
	  		  ;;
			*) man
			  ;;
		  esac
			;;
		*) man
			;;
	  esac
	  ;;
	"exit")
	  exit 1
	  ;;
	*)
	  man
	  ;;
	# Todo: catch arrow up and down
    esac
  done
}

init
